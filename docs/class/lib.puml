@startuml lib-class-diagram

package lib {
    abstract class AbstractGraph {
        + __init__()
        + {abstract} {static} from_gephi(edges_file: Path, vertices_file: Path) : AbstractGraph
        + {abstract} get_vertex_count() : int
        + {abstract} get_edge_count() : int
        + {abstract} has_edge(u: int, v: int) : bool
        + {abstract} add_edge(u: int, v: int)
        + {abstract} remove_edge(u: int, v: int)
        + {abstract} is_successor(u: int, v: int) : bool
        + {abstract} is_predecessor(u: int, v: int) : bool
        + {abstract} is_divergent(u1: int, v1: int, u2: int, v2: int) : bool
        + {abstract} is_convergent(u1: int, v1: int, u2: int, v2: int) : bool
        + {abstract} is_incident(u: int, v: int, x: int) : bool
        + {abstract} get_vertex_in_degree(u: int) : int
        + {abstract} get_vertex_out_degree(u: int) : int
        + {abstract} set_vertex_weight(v: int, w: float)
        + {abstract} get_vertex_weight(v: int) : float
        + {abstract} get_vertex_label(v: int) : str
        + {abstract} set_vertex_label(v: int, label: str)
        + {abstract} set_edge_weight(u: int, v: int, w: float)
        + {abstract} get_edge_weight(u: int, v: int) : float
        + {abstract} is_connected() : bool
        + {abstract} is_empty_graph() : bool
        + {abstract} is_complete_graph() : bool
        + {abstract} export_to_gephi(path: PathLike)
    }

    class Vertex {
        - _label : str
        - _weight : float
        + __init__(label: str, weight: float)
        + get_label() : str
        + get_weight() : float
        + set_label(new_name: str)
        + set_weight(new_weight: float)
    }

    class AdjacencyGraphList {
        - __vertices : List[Vertex]
        - __adjacency_lists : List[List[Tuple[Vertex, float]]]
        + {static} from_gephi(edges_file: Path, vertices_file: Path) : AdjacencyGraphList
    }

    class AdjacencyMatrixGraph {
        - _num_vertices : int
        - _vertices : List[Vertex]
        - matriz : List[List[float]]
        + {static} from_gephi(edges_file: Path, vertices_file: Path) : AdjacencyMatrixGraph
    }

    class ExtractorConfig {
        - __key : str
        - __logins : List[LoginExtractor]
        - __interactions : List[InteractionExtractor]
        + __init__(key: str, logins: List, interactions: List)
        + key : str <<property>>
        + logins : List[LoginExtractor] <<property>>
        + interactions : List[InteractionExtractor] <<property>>
    }

    class InteractionsData {
        - __logins : Set[str]
        - __interactions : Dict[str, Set[str]]
        - __weights : Dict[Tuple[str, str], float]
        + __init__()
        + add_login(login: str)
        + add_interaction(source: str, target: str, weight: Optional[float])
        + get_weight(source: str, target: str) : float
        + authors : Set[str] <<property>>
        + interactions : Dict[str, Set[str]] <<property>>
    }

    class InteractionsDataFactory {
        + {static} build_from_extractors(file_path: Union[str, PathLike], extractors: List[ExtractorConfig]) : InteractionsData
        + {static} build_closed_issues_graph(file_path: str) : InteractionsData
        + {static} build_approve_merge_revision_pull_requests_graph(file_path: str) : InteractionsData
        + {static} build_comments_pull_requests_issues_graph(file_path: str) : InteractionsData
        + {static} build_integrated_weighted_graph(file_path: str) : InteractionsData
    }

    class GraphParser {
        - __mapper : Dict[str, int]
        - __graph_factory : Callable[[int], AbstractGraph]
        - __graph : AbstractGraph | None
        + __init__(graph_factory: Callable[[int], AbstractGraph])
        - __get_vertex_idx(login_name: str) : int
        - __add_interaction(source_login: str, target_login: str, weight: float)
        + get_graph(data: InteractionsData) : AbstractGraph
    }

    abstract class AbstractGraphStatistics {
        # graph : AbstractGraph
        + {abstract} calculate_degree_centrality() : Dict[int, float]
        + {abstract} calculate_in_degree_centrality() : Dict[int, float]
        + {abstract} calculate_out_degree_centrality() : Dict[int, float]
        + {abstract} calculate_betweenness_centrality(parallel: bool) : Dict[int, float]
        + {abstract} calculate_closeness_centrality(parallel: bool) : Dict[int, float]
        + {abstract} calculate_pagerank(...) : Dict[int, float]
        + {abstract} calculate_eigenvector_centrality(...) : Dict[int, float]
        + {abstract} calculate_density() : float
        + {abstract} calculate_clustering_coefficient() : Dict[int, float]
        + {abstract} calculate_average_clustering() : float
        + {abstract} calculate_assortativity() : float
        + {abstract} detect_communities() : Dict[int, int]
        + {abstract} calculate_modularity() : float
        + {abstract} identify_bridging_nodes() : Dict[int, bool]
        + {abstract} get_or_calculate_metrics(parallel: bool) : Dict
        + {abstract} calculate_all_metrics(parallel: bool) : Dict
        + {abstract} export_metrics_to_csv(output_file: Path)
    }

    class ManualGraphStatistics {
        - nodes : Set[int]
        - edges : Dict[int, Dict[int, float]]
        - in_edges : Dict[int, Dict[int, float]]
        - node_weights : Dict[int, float]
        - vertex_labels : Dict[int, str]
        - _metrics_cache : Dict[str, Dict[int, float]]
        - _load_from_graph()
        - _get_neighbors(node: int) : List[int]
        - _get_predecessors(node: int) : List[int]
        - _get_all_neighbors_undirected(node: int) : Set[int]
        - _bfs_shortest_paths(source: int) : Tuple[Dict, Dict]
        - _compute_betweenness_single_source(source: int) : Dict[int, float]
        - _compute_closeness_single_node(node: int) : float
        - _modularity_gain_optimized(...) : float
    }

    class NetworkXGraphStatistics {
        - _nx_graph : nx.DiGraph
        - _metrics_cache : Dict[str, Dict[int, float]]
        - _convert_to_networkx() : nx.DiGraph
        {note: requires numpy and scipy}
    }

    class GraphFactory {
        + {static} from_gephi(edges_file: Path, vertices_file: Path, graph_type: str) : AbstractGraph
    }

    AbstractGraph <|-- AdjacencyGraphList
    AbstractGraph <|-- AdjacencyMatrixGraph
    AdjacencyGraphList *-- Vertex : contains
    AdjacencyMatrixGraph *-- Vertex : contains

    AbstractGraphStatistics <|-- ManualGraphStatistics : extends
    AbstractGraphStatistics <|-- NetworkXGraphStatistics : extends
    AbstractGraphStatistics o-- AbstractGraph : contains

    InteractionsDataFactory ..> InteractionsData : creates
    InteractionsDataFactory ..> ExtractorConfig : uses
    
    GraphParser ..> InteractionsData : uses
    GraphParser ..> AbstractGraph : creates
    GraphParser o-- AbstractGraph : contains

    GraphFactory ..> AdjacencyGraphList : creates
    GraphFactory ..> AdjacencyMatrixGraph : creates
    GraphFactory ..> AbstractGraph : returns
}

package "concurrent.futures (External)" <<External>> {
    class ThreadPoolExecutor {
        + submit(fn: Callable) : Future
        + __enter__() : ThreadPoolExecutor
        + __exit__()
    }
}

package "networkx (External)" <<External>> {
    class nx.DiGraph {
        + add_node(node_id, **attrs)
        + add_edge(u, v, **attrs)
        + nodes()
        + edges()
    }
}

ManualGraphStatistics ..> ThreadPoolExecutor : uses for parallelization
NetworkXGraphStatistics ..> nx.DiGraph : uses

@enduml
